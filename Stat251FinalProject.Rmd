---
title: "Stat251 Final Project"
author: "Emily Liu"
date: "3/25/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(invgamma)
```

1. 

Alzheimer’s is a brain disease where cells degenerate and cause memory loss. 40 million people worldwide suffer from this disease and a cure does not exist. Although there is no definitive cause of Alzheimer’s, scientists speculate that genetics, aging, and environmental influences may affect the probability of developing the disease. Some specialists have found that the larger the brain, the more the brain may combat against the effects of cognitive atrophy. The total intracranial volume (TIV) is a way to quantify the size of the brain. TIV includes the volume of the cranium, brain, and spinal fluid. To discover how brain size relates to Alzheimer’s, we will investigate the average TIV for patients 60 years and older of those with and without the disease.

2.

Likelihood:
$$
x_i | \mu, \sigma^2 ~ N(\mu, \sigma^2), i = 1, ...n
$$

3.
Priors for demented population:
$\mu_D \sim N(\lambda, tau^2)$

$\sigma_D \sim IG(\gamma, \phi)$

Priors for non-demented population:
$\mu_N \sim N(\lambda, tau^2)$

$\sigma_N \sim IG(\gamma, \phi)$


4.
```{r}
# filepath <- paste0('~/Documents/Winter 2022/Stat251/alzheimer.csv')
filepath <- 'alzheimer.csv'
alz <- read.csv(filepath, stringsAsFactors = TRUE)
```


## Data exploration
```{r}
# measurements of total intracranial volume
demented <- alz %>% filter(Group == 'Demented')
nondemented <- alz %>% filter(Group == 'Nondemented')
hist(data$eTIV)
alz
```

```{r}
# Prior for mu
prior_mean <- 1500 # lambda
prior_var <- 31000 # Tau^2

# Prior for sigma2
prior_mean_sigma2 <- 1
prior_var_sigma2 <- 1


```

5.
```{r}
demented <- alz %>% filter(Group == 'Demented') %>% select(eTIV)


# Find the posterior of mu using Gibbs sampling.
n <- length(demented)
# Starting values (This example has extreme starting values just for illustrative purposes)
lambda <- 1500  # Prior Mean for mu
tau2 <- 31000  # Prior Variance for mu
sigma2 <- 1  # Sample Variance

gamma <- 1  # Prior Gamma for sigma2
phi <- 1  # Prior Phi for sigma2


# initializations for the Gibbs Sampling Algorithm
iters <- 10000
mu.save <- rep(0, iters)
mu.save[1] <- mu
sigma2.save <- rep(0, iters)
sigma2.save[1] <- sigma2

#Gibbs Sampling Algorithm
for(t in 2:iters){
  # Full conditional of mu (update the value of the parameters)
  lambda.p <- (tau2*sum(demented) + sigma2*lambda)/(tau2*n + sigma2) #posterior mean of mu given data and sigma^2 aka its full conditional
  tau2.p <- sigma2*tau2/(tau2*n + sigma2)  # posterior variance
  
  #sample a new value of mu from its full conditional
  mu <- rnorm(1, lambda.p, sqrt(tau2.p))
  
  #save the value of mu
  mu.save[t] <- mu
  
  # full conditional of sigma2 (update the value of the parameters)
  gamma.p <- gamma + n/2
  phi.p <- phi + sum((demented - mu)^2 )/2
  
  #sample new value of sigma2 from its full conditional
  sigma2 <- rinvgamma(1, gamma.p, phi.p)
  
  #save the value of sigma2
  sigma2.save[t] <- sigma2
}

# Trace plots (decide if we need to throw out the first few values)
plot(mu.save, type='l')
plot(sigma2.save, type='l')

#throw out the first few values
burn <- 100
mu.use_demented <- mu.save[-(1:burn)]
sigma2.use_demented <- sigma2.save[-(1:burn)]
plot(mu.use_demented, type='l')
plot(sigma2.use_demented, type='l')

# marginal posterior distribution of mu (NOT conditional on sigma2)
plot(density(mu.use_demented), xlim=c(0, 10000), xlab=expression(sigma^2), 
     ylab="density", main=expression(pi(mu~"|"~data)))

# marginal posterior distribution of sigma2 (NOT conditional on sigma2)
plot(density(sigma2.use_demented), xlim=c(0, 500000), xlab=expression(sigma^2), 
     ylab="density", main=expression(pi(sigma^2~"|"~data)))
```

```{r}
nondemented <- alz %>% filter(Group == 'Nondemented') %>% select(eTIV)


# Find the posterior of mu using Gibbs sampling.
n <- length(nondemented)
# Starting values (This example has extreme starting values just for illustrative purposes)
lambda <- 1500  # Prior Mean for mu
tau2 <- 31000  # Prior Variance for mu
sigma2 <- 1  # Sample Variance

gamma <- 1  # Prior Gamma for sigma2
phi <- 1  # Prior Phi for sigma2


# initializations for the Gibbs Sampling Algorithm
iters <- 10000
mu.save <- rep(0, iters)
mu <- 1500
mu.save[1] <- mu
sigma2.save <- rep(0, iters)
sigma2.save[1] <- sigma2

#Gibbs Sampling Algorithm
for(t in 2:iters){
  # Full conditional of mu (update the value of the parameters)
  lambda.p <- (tau2*sum(nondemented) + sigma2*lambda)/(tau2*n + sigma2) #posterior mean of mu given data and sigma^2 aka its full conditional
  tau2.p <- sigma2*tau2/(tau2*n + sigma2)  # posterior variance
  
  #sample a new value of mu from its full conditional
  mu <- rnorm(1, lambda.p, sqrt(tau2.p))
  
  #save the value of mu
  mu.save[t] <- mu
  
  # full conditional of sigma2 (update the value of the parameters)
  gamma.p <- gamma + n/2
  phi.p <- phi + sum((nondemented - mu)^2 )/2
  
  #sample new value of sigma2 from its full conditional
  sigma2 <- rinvgamma(1, gamma.p, phi.p)
  
  #save the value of sigma2
  sigma2.save[t] <- sigma2
}

# Trace plots (decide if we need to throw out the first few values)
plot(mu.save, type='l')
plot(sigma2.save, type='l')

#throw out the first few values
burn <- 100
mu.use_nondemented <- mu.save[-(1:burn)]
sigma2.use_nondemented <- sigma2.save[-(1:burn)]
plot(mu.use_nondemented, type='l')
plot(sigma2.use_nondemented, type='l')

# marginal posterior distribution of mu (NOT conditional on sigma2)
plot(density(mu.use_nondemented), xlim=c(0, 10000), xlab=expression(sigma^2), 
     ylab="density", main=expression(pi(mu~"|"~data)))

# marginal posterior distribution of sigma2 (NOT conditional on sigma2)
plot(density(sigma2.use_nondemented), xlim=c(0, 4000000000), xlab=expression(sigma^2), 
     ylim=c(0, 0.00000001), ylab="density", main=expression(pi(sigma^2~"|"~data)))
```

We want to discover the difference between means
```{r}
d <- mu.use_demented - mu.use_nondemented
# plot(density(d), xlim=c(-500000, 500000), xlab=expression(sigma^2), ylab="density", main=expression(pi(d~"|"~data)) )
plot(density(d), xlim=c(-5000, 5000), xlab="sigma^2", ylab="density",
     main="Posterior dist of urban-rural" )
mean(d)

# 95% credible interval
quantile(d, c(.025, .975)) # The difference between TIV size between demented and nondemented is insignificant since our credible interval contains 0.
```


We want to discover the difference between standard deviations
```{r}
d <- sqrt(sigma2.use_demented) - sqrt(sigma2.use_nondemented)
# plot(density(d), xlim=c(-500000, 500000), xlab=expression(sigma^2), ylab="density", main=expression(pi(d~"|"~data)) )
plot(density(d), xlim=c(-30000, 30000), xlab="sigma^2", ylab="density",
     main="Posterior dist of urban-rural" )
mean(d)

# 95% credible interval
quantile(d, c(.025, .975)) # The difference between the standard deviation of TIV size between demented and nondemented is insignificant since our credible interval contains 0.
```

